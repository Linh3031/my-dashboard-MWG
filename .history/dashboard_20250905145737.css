/* Version 7.3 - Final Fixes */
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');

:root {
    /* Contrast Levels */
    --bg-lightness-1: 96%; --header-lightness-1: 95%; --header-text-lightness-1: 20%; --special-header-lightness-1: 90%; --below-target-lightness-1: 95%;
    --bg-lightness-2: 94%; --header-lightness-2: 92%; --header-text-lightness-2: 18%; --special-header-lightness-2: 85%; --below-target-lightness-2: 92%;
    --bg-lightness-3: 92%; --header-lightness-3: 88%; --header-text-lightness-3: 15%; --special-header-lightness-3: 80%; --below-target-lightness-3: 88%;
    
    /* KPI Card Colors - Default */
    --kpi-card-1-bg: #38bdf8; /* sky-400 */
    --kpi-card-2-bg: #34d399; /* emerald-400 */
    --kpi-card-3-bg: #fbbF24; /* amber-400 */
    --kpi-card-4-bg: #2dd4bf; /* teal-400 */
    --kpi-card-5-bg: #a78bfa; /* violet-400 */
    --kpi-text-color: #ffffff;
}

body { font-family: 'Inter', sans-serif; background-color: #f3f4f6; }
body[data-contrast="1"] { --bg-lightness: var(--bg-lightness-1); --header-lightness: var(--header-lightness-1); --header-text-lightness: var(--header-text-lightness-1); --special-header-lightness: var(--special-header-lightness-1); --below-target-lightness: var(--below-target-lightness-1); }
body[data-contrast="2"] { --bg-lightness: var(--bg-lightness-2); --header-lightness: var(--header-lightness-2); --header-text-lightness: var(--header-text-lightness-2); --special-header-lightness: var(--special-header-lightness-2); --below-target-lightness: var(--below-target-lightness-2); }
body[data-contrast="3"] { --bg-lightness: var(--bg-lightness-3); --header-lightness: var(--header-lightness-3); --header-text-lightness: var(--header-text-lightness-3); --special-header-lightness: var(--special-header-lightness-3); --below-target-lightness: var(--below-target-lightness-3); }

::-webkit-scrollbar { width: 8px; }
::-webkit-scrollbar-track { background: #f1f1f1; }
::-webkit-scrollbar-thumb { background: #888; border-radius: 10px; }
::-webkit-scrollbar-thumb:hover { background: #555; }

/* --- SIDEBAR & MAIN CONTENT --- */
#sidebar { width: 68px; transition: width 0.3s ease-in-out; overflow-x: hidden; }
#sidebar:hover { width: 256px; }
#sidebar.menu-locked:hover { width: 68px; }
.menu-text { transition: opacity 0.2s ease-in-out; opacity: 0; white-space: nowrap; }
#sidebar:hover .menu-text { opacity: 1; transition-delay: 0.1s; }
#sidebar.menu-locked:hover .menu-text { opacity: 0; }
#main-content { transition: margin-left 0.3s ease-in-out; margin-left: 68px; }
#sidebar .nav-link { white-space: nowrap; }

/* --- SETTINGS DRAWERS --- */
.settings-drawer {
    width: 400px;
    max-width: 90vw;
    transform: translateX(-100%);
    transition: transform 0.3s ease-in-out;
}
.settings-drawer.open { transform: translateX(0); }
.close-drawer-btn { font-size: 2rem; line-height: 1; }

/* --- NOTIFICATION --- */
#notification { position: fixed; bottom: 20px; right: 20px; padding: 1rem 1.5rem; border-radius: 0.5rem; color: white; z-index: 1000; opacity: 0; transition: opacity 0.5s, transform 0.5s; transform: translateY(100px); }
#notification.show { opacity: 1; transform: translateY(0); }
.notification-success { background-color: #28a745; }
.notification-error { background-color: #dc3545; }

/* --- TABS & SORTING --- */
.sub-tab-btn { transition: all 0.2s ease-in-out; border-bottom: 2px solid transparent; }
.sub-tab-btn.active { border-color: #3b82f6; color: #3b82f6; background-color: #eff6ff; }
.sortable { cursor: pointer; position: relative; user-select: none; }
.sort-indicator { display: inline-flex; flex-direction: column; align-items: center; justify-content: center; width: 1em; height: 1em; margin-left: 4px; vertical-align: middle; color: #9ca3af; transition: color 0.2s ease-in-out; }
.sortable .sort-indicator::before { content: '▲'; font-size: 0.8em; line-height: 0.5; opacity: 0.4; }
.sortable .sort-indicator::after { content: '▼'; font-size: 0.8em; line-height: 0.5; opacity: 0.4; }
.sortable:hover .sort-indicator { color: #374151; }
.sortable.sorted-asc .sort-indicator::before { opacity: 1; color: #3b82f6; }
.sortable.sorted-asc .sort-indicator::after { opacity: 0.4; }
.sortable.sorted-desc .sort-indicator::after { opacity: 1; color: #3b82f6; }
.sortable.sorted-desc .sort-indicator::before { opacity: 0.4; }

/* --- TABLE STYLES & DYNAMIC COLORS --- */
.table-bordered { border-collapse: collapse; }
.table-bordered th, .table-bordered td { border: 1px solid #e5e7eb; }
.table-striped tbody tr:nth-child(even) { background-color: #f9fafb; }
.table-footer { background-color: hsl(210, 20%, var(--header-lightness)); border-top: 2px solid #9ca3af; }
.cell-performance.is-below { background-color: hsl(0, 80%, var(--below-target-lightness)); }
.header-bg-blue { background-color: hsl(217, 95%, var(--special-header-lightness)) !important; color: hsl(217, 80%, var(--header-text-lightness)) !important; }
.header-bg-green { background-color: hsl(145, 80%, var(--special-header-lightness)) !important; color: hsl(145, 70%, var(--header-text-lightness)) !important; }
.header-bg-yellow { background-color: hsl(45, 95%, var(--special-header-lightness)) !important; color: hsl(45, 80%, var(--header-text-lightness)) !important; }
.header-group-1 { background-color: hsl(30, 90%, var(--header-lightness)); }
.header-group-2 { background-color: hsl(90, 90%, var(--header-lightness)); }
.header-group-3 { background-color: hsl(180, 90%, var(--header-lightness)); }
.qdc-group-title { font-weight: 600; }
.qdc-group-ict { background-color: hsl(190, 80%, var(--bg-lightness)); }
.qdc-group-vas { background-color: hsl(140, 80%, var(--bg-lightness)); }
.qdc-group-giadung { background-color: hsl(0, 80%, var(--bg-lightness)); }
.qdc-group-sim { background-color: hsl(40, 80%, var(--bg-lightness)); }
.competition-header-doanhthu { border-color: #a78bfa; background-color: hsl(260, 90%, var(--bg-lightness)); }
.competition-header-soluong { border-color: #facc15; background-color: hsl(50, 90%, var(--bg-lightness)); }
.header-highlight-special { background-color: hsl(25, 90%, var(--header-lightness)) !important; }

/* --- KPI CARDS --- */
.kpi-card { color: var(--kpi-text-color); }
/* Sửa lỗi #1, #4: Đảm bảo các thẻ p kế thừa màu từ thẻ cha */
.kpi-card p { color: inherit; }
.kpi-card-title { opacity: 0.8; }
.kpi-percentage, .kpi-percentage-value {
    font-size: 1.2em;
    font-weight: 700;
    color: #a50a0a !important; /* Luôn giữ màu đỏ đậm cho tỷ lệ, ghi đè lên tất cả */
}
#luyke-kpi-cards-container .kpi-card:nth-child(1), #realtime-kpi-cards-container .kpi-card:nth-child(1) { background-color: var(--kpi-card-1-bg); }
#luyke-kpi-cards-container .kpi-card:nth-child(2), #realtime-kpi-cards-container .kpi-card:nth-child(2) { background-color: var(--kpi-card-2-bg); }
#luyke-kpi-cards-container .kpi-card:nth-child(3), #realtime-kpi-cards-container .kpi-card:nth-child(3) { background-color: var(--kpi-card-3-bg); }
#luyke-kpi-cards-container .kpi-card:nth-child(4), #realtime-kpi-cards-container .kpi-card:nth-child(4) { background-color: var(--kpi-card-4-bg); }
#luyke-kpi-cards-container .kpi-card:nth-child(5) { background-color: var(--kpi-card-5-bg); }


/* --- PROGRESS BAR & MISC --- */
.progress-bar-container { overflow: hidden; }
.progress-bar { background-image: linear-gradient(45deg, rgba(255, 255, 255, .15) 25%, transparent 25%, transparent 50%, rgba(255, 255, 255, .15) 50%, rgba(255, 255, 255, .15) 75%, transparent 75%, transparent); background-size: 1rem 1rem; animation: progress-bar-stripes 1s linear infinite; }
@keyframes progress-bar-stripes { from { background-position: 1rem 0; } to { background-position: 0 0; } }
#sknv-details-container .sknv-subtable-header th { font-size: 0.875rem; font-weight: 600; background-color: #f3f4f6; }
.choices__inner { min-height: 42px; }
.choices__list--multiple .choices__item { background-color: #3b82f6; border-color: #2563eb; }

/* --- TOGGLE FILTERS & HIGHLIGHTING --- */
.toggle-filters-btn { display: inline-flex; align-items: center; gap: 0.5rem; padding: 0.5rem 1rem; border-radius: 0.5rem; background-color: #f3f4f6; color: #4b5563; font-weight: 500; font-size: 0.875rem; cursor: pointer; transition: background-color 0.2s ease-in-out; margin-bottom: 1rem; border: 1px solid #e5e7eb; }
.toggle-filters-btn:hover { background-color: #e5e7eb; }
.toggle-filters-btn .icon { width: 1rem; height: 1rem; transition: transform 0.3s ease-in-out; }
.toggle-filters-btn.active .icon { transform: rotate(180deg); }
.advanced-filters { padding: 1.25rem; border: 1px dashed #9ca3af; border-radius: 0.5rem; background-color: #f9fafb; margin-top: 0.5rem; }
.highlight-trigger { background: none; border: none; cursor: pointer; color: #6b7280; }
.highlight-trigger:hover { color: #1d4ed8; }
.highlighted-row td { animation: pulse-bg 2s infinite; }
@keyframes pulse-bg { 0% { background-color: var(--highlight-color, #ffff99); } 50% { background-color: var(--highlight-color-light, #ffffcc); } 100% { background-color: var(--highlight-color, #ffff99); } }

/* --- CAPTURE STYLES --- */
.capture-layout-grid-2x2 { display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px; padding: 16px; background-color: #f3f4f6; width: 1400px; }
.capture-layout-grid-2x2 > div { background-color: #ffffff; border-radius: 0.75rem; box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1); border: 1px solid #e5e7eb; overflow: hidden; display: flex; flex-direction: column; }
.capture-layout-grid-2x2 > div > * { flex-grow: 1; }
.capture-layout-grid-2x2 { font-size: 16px !important; }
.capture-layout-grid-2x2 h3, .capture-layout-grid-2x2 h4 { font-size: 20px !important; padding: 14px !important; }
.capture-layout-grid-2x2 table { width: 100% !important; border-collapse: collapse !important; }
.capture-layout-grid-2x2 th, .capture-layout-grid-2x2 td { padding: 10px 12px !important; white-space: normal !important; word-break: break-word; vertical-align: middle !important; text-align: right; }
.capture-layout-grid-2x2 th { font-weight: bold !important; background-color: #f9fafb !important; }
.capture-layout-grid-2x2 td:first-child, .capture-layout-grid-2x2 th:first-child { text-align: left; }
.capture-layout-grid-2x2 img { max-width: 100%; height: auto; display: block; margin: 0 auto; padding: 1rem; }